# 基金实时估值看板

纯前端的基金实时估值与持仓管理面板，支持添加自选、记录买卖、查看收益与走势，数据存于本地或可同步到 GitHub Gist。

![基金实时估值看板](https://github.com/user-attachments/assets/62eddc44-3554-4580-8837-5f61112356ef)

## 功能概览

- **实时估值**：交易时段约 30 秒刷新，非交易时段约 5 分钟刷新
- **基金搜索**：输入 6 位代码或基金名称，支持自动补全
- **持有 / 自选**：自动区分「持有」与「自选」，分标签展示
- **买卖记录**：记录申购、买入、卖出，自动算持仓成本与收益
- **投资总览**：总市值、今日盈亏、持仓收益、累计收益、迷你走势
- **净值与图表**：支持刷新实际净值（晚间公布后）、历史净值走势图（Chart.js）
- **排序**：默认顺序 / 涨跌幅从高到低 / 从低到高
- **主题**：亮色 / 暗色一键切换
- **备份与恢复**：导出 JSON、导出 CSV、从 JSON 导入
- **云同步**：通过 GitHub Gist 上传/下载数据（需配置 Personal Access Token）
- **拖拽排序**：卡片可拖拽调整顺序
- **今日区间**：显示当日最高/最低估值（需在交易时段有刷新记录）

## 使用方式

- **本地**：用浏览器直接打开 `index.html`，或放到任意静态站点（如 GitHub Pages）访问。
- **依赖**：仅通过 CDN 引入 Chart.js，无需安装或构建。

数据保存在浏览器 `localStorage`，换设备或清缓存会丢失，建议定期用「更多 → 导出 JSON」备份，或配置云同步。

## 技术说明

- 单文件应用：所有 HTML、CSS、JavaScript 均在 `index.html` 内
- 图表：Chart.js 4.4.0（cdn.jsdelivr.net）
- 数据源：基金列表与估值等通过前端请求公开接口获取（见代码内 `fetch` 逻辑）
- 云同步：使用 GitHub Gist API，需在「云同步设置」中填写 Gist ID 与 PAT

## 截图说明

上图为主界面示意：顶部为基金搜索与添加、排序与主题、更多（备份/云同步）；下方为投资总览与基金卡片列表（持有/自选、估值、收益、操作入口）。

---

## 可优化点（按优先级）

以下为基于当前代码的优化建议，可按需逐步实施。

### 高优先级

| 方向 | 说明 |
|------|------|
| **安全：innerHTML 与 XSS** | `showCustomConfirm(..., isHtml = true)` 用 `innerHTML` 渲染内容，若 message 来自用户输入存在 XSS 风险。建议：仅对可信文案使用 isHtml，或改为白名单标签 + 转义。 |
| **数据持久化健壮性** | `localStorage` 写满或不可用时可能抛错，目前部分 `setItem` 未 try/catch。建议：对读写做统一封装，失败时 Toast 提示并降级（如仅内存）。 |
| **节假日数据维护** | `CN_MARKET_HOLIDAYS` 硬编码 2024–2026，每年需手动更新。建议：抽成单独 JSON 或配置文件，或提供「更新休市日历」说明/入口。 |

### 中优先级

| 方向 | 说明 |
|------|------|
| **代码结构** | 单文件约 7800+ 行，维护成本高。可考虑：拆成多 JS 模块（数据层 / 渲染 / 云同步等）+ 独立 CSS，或至少按功能用注释分块，便于后续拆分。 |
| **全局状态** | 大量顶层 `let`（fundsData、positions、charts 等）易冲突、难测试。可收敛为单一 state 对象或模块，便于状态快照与调试。 |
| **错误对用户可见** | 部分 `fetch` 失败仅 `console.error`，用户无感知。关键流程（如加载基金、云同步、导入）建议在失败时 `showToast` 或模态提示。 |
| **无障碍与焦点** | 除 toast 的 `aria-live` 外，模态框、标签页、关键按钮可补充 `aria-*` 与焦点管理（打开时焦点进弹窗、关闭时还原）。 |
| **SEO / 元信息** | 若部署为公开页，可增加 `<meta name="description">` 和 `keywords`，便于搜索与预览。 |

### 低优先级 / 长期

| 方向 | 说明 |
|------|------|
| **性能** | 基金数量多时，可考虑图表按需创建（点击展开再初始化 Chart）、或虚拟列表减少 DOM；基金列表脚本可按需/分片加载。 |
| **动效与偏好** | 支持 `prefers-reduced-motion: reduce`，对动画做降级，提升可访问性。 |
| **配置外置** | 刷新间隔、API 基地址、休市日历等可抽到顶部或单独 config，方便改配置不碰业务逻辑。 |
| **文档** | README 可补充：导出 JSON 结构说明、云同步 Gist 文件格式、本地运行/部署步骤。 |
| **测试** | 核心逻辑（如持仓计算、`getNextTradingDay`、净值日期）可抽成纯函数并写单元测试，便于重构。 |
| **Token 安全** | GitHub Token 存 localStorage，若存在 XSS 会泄露。可在 README 或设置页提醒使用最小权限 Token、勿在公用电脑保存。 |
